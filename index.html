<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>maria isolina cozzani — portfolio</title>
  <meta name="description" content="violinist, composer-performer, multimedia artist. works, bio, contact." />

  <meta name="color-scheme" content="light">
  <meta name="theme-color" content="#ffffff">

  <meta property="og:title" content="Maria Isolina Cozzani - Violinist, Composer-Performer, Multimedia Artist">
  <meta property="og:description" content="Portfolio of Maria Isolina Cozzani - works, bio, contact information">
  <meta property="og:type" content="website">
  <meta property="og:image" content="assets/og-image.jpg">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="robots" content="index,follow">

  <link rel="icon" href="/assets/favicon.ico">
  <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png">

  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Space+Grotesk:wght@600;700&family=Source+Sans+3:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root {
      --txt:#0a0a0d; --bg:#ffffff; --muted:#5a5f66; --accent:#7ed321; --border:#e6e7ea; --max:1440px; --radius:0;
      --brand-pink:#ff4fd8;
      --font-base:'Source Sans 3', ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      --font-heading:'Space Grotesk', ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      --font-curvy:'Pacifico', cursive;
    }
    html{box-sizing:border-box;scroll-behavior:smooth;color-scheme:light}
    *,*::before,*::after{box-sizing:inherit}
    body{
      margin:0;color:var(--txt);background:var(--bg);
      background-image:
        radial-gradient(120% 120% at 12% 8%, rgba(255,79,216,.06), transparent 60%),
        radial-gradient(120% 120% at 88% 82%, rgba(126,211,33,.06), transparent 60%);
      font:16px/1.7 var(--font-base); text-rendering:optimizeLegibility;
      position:relative; overflow-x:hidden; cursor:none;
    }
    a{color:var(--accent);text-decoration:none;transition:all .2s ease}
    a:focus-visible,button:focus-visible{outline:2px solid var(--brand-pink);outline-offset:3px;border-radius:2px}

    .wrap{max-width:var(--max);margin:0 auto;padding:28px 18px;position:relative;z-index:0}
    header{margin:8px 0 18px}
    h1{font-family:var(--font-heading);font-size:32px;font-weight:700;letter-spacing:.02em;margin:0 0 6px;color:var(--accent);position:relative}
    nav{margin:14px 0 26px;font-family:var(--font-heading);letter-spacing:.01em;font-weight:600}
    nav a{margin:0 10px 0 0;white-space:nowrap;color:var(--brand-pink);position:relative;padding:4px 0;text-decoration:underline;text-underline-offset:3px}
    nav a::after{content:'';position:absolute;bottom:0;left:0;width:0;height:2px;background:var(--brand-pink);transition:width .3s ease}
    nav a:hover::after, nav a:focus-visible::after{width:100%}

    main section{margin:38px 0}
    h2{font-family:var(--font-heading);font-size:18px;margin:0 0 12px;color:var(--accent)}
    h3{font-family:var(--font-heading);font-size:16px;margin:0 0 8px}
    .muted{color:var(--muted);opacity:.9}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

    /* Cards */
    .card{padding:16px;border-radius:0;background:rgba(255,255,255,.9);border:1px solid var(--border);
      transition:transform .2s ease, box-shadow .2s ease, border-color .2s ease; position:relative; z-index:1; backdrop-filter:saturate(110%) blur(0px)}
    .card:hover{transform:translateY(-2px); box-shadow:0 6px 22px rgba(0,0,0,0.08); border-color:var(--brand-pink)}

    /* Gallery */
    .thumbs{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px}
    .thumb{position:relative;display:block;border-radius:0;overflow:hidden;background:var(--bg);border:1px solid var(--border);
      transition:transform .18s ease, border-color .18s ease, box-shadow .18s ease, filter .18s ease;
      transform-origin:center center; transform: translateY(var(--ty,0)) scale(var(--s,1));}
    .thumb .poster{aspect-ratio:16/9;width:100%;object-fit:cover;display:block;filter:grayscale(.08) contrast(1.04);transition:filter .18s ease;will-change:filter,transform}
    .thumb:hover{border-color:var(--brand-pink); box-shadow:0 10px 26px rgba(255,79,216,.15); --ty:-2px}
    .thumb:hover .poster{filter:grayscale(0) contrast(1.08) saturate(1.08)}
    .thumb:focus-visible{outline:2px solid var(--brand-pink);outline-offset:2px}

    /* Detail view */
    body.is-detail main>section:not(#work-detail){display:none}
    #work-detail{margin-top:10px}
    #work-detail .back{display:inline-flex;align-items:center;gap:6px;margin:6px 0 16px;font-size:13px;color:var(--muted);padding:6px 12px;border:1px solid var(--border);border-radius:2px;transition:all .2s ease;cursor:none}
    #work-detail .back:hover{color:var(--txt);border-color:var(--brand-pink);background:rgba(255,79,216,0.05)}
    .embed{position:relative;padding-top:56.25%;border-radius:var(--radius);overflow:hidden;border:1px solid var(--border);background:rgba(0,0,0,0.03);margin-bottom:14px}
    .embed iframe{position:absolute;inset:0;width:100%;height:100%;border:0}

    /* Media grids */
    .detail-media-grid{display:grid;grid-template-columns:1fr;gap:12px;margin-bottom:14px}
    @media (min-width:900px){.detail-media-grid{grid-template-columns:1fr 1fr}}
    .detail-media-grid img{width:100%;aspect-ratio:16/9;object-fit:cover;border-radius:0;border:1px solid var(--border)}
    .video-grid{display:grid;grid-template-columns:1fr;gap:12px;margin:12px 0}
    @media (min-width:820px){.video-grid{grid-template-columns:1fr 1fr}}
    .photo-grid,.media-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:10px 0}
    @media (min-width:720px){.photo-grid,.media-grid{grid-template-columns:repeat(3,1fr)}}
    .photo-grid img,.media-grid img{width:100%;height:100%;object-fit:cover;border-radius:0;border:1px solid var(--border)}
    .media-grid .span-3{grid-column:1/-1}

    /* Bio */
    #bio{--aside:260px}
    #bio .bio-grid{display:grid;grid-template-columns:1fr;gap:18px;align-items:start}
    #bio .bio-aside h2{margin:0 0 8px}
    #bio .bio-aside .small{font-size:12px}
    #bio .bio-content{text-wrap:pretty}
    #bio .bio-content p{margin:0 0 12px;text-align:justify;hyphens:auto;orphans:2;widows:2;font-size:15px;line-height:1.75}
    @media (min-width:980px){
      #bio .bio-grid{grid-template-columns:var(--aside) 1fr;gap:28px}
      #bio .bio-aside{position:sticky;top:18px;align-self:start}
      #bio .bio-content{column-count:2;column-gap:28px;column-fill:balance}
      #bio .bio-content p{break-inside:avoid}
    }

    /* Contact */
    .contact-line{display:inline-flex;align-items:center;gap:10px;font-weight:600;color:var(--txt)}
    .icon-mail{width:18px;height:18px;fill:var(--accent)}

    footer{margin:44px 0 12px;font-size:13px;color:var(--muted)}

    /* Performance */
    #works-data,#bio,#contact{content-visibility:auto;contain-intrinsic-size:1px 1000px}

    /* Mobile */
    @media (max-width:480px){
      .wrap{padding:20px 12px}
      h1{font-size:26px}
      nav a{margin:0 8px 0 0;font-size:14px}
      .thumbs{grid-template-columns:1fr;gap:12px}
      .card{padding:12px}
    }

    /* Nascondi la “manina”: usiamo solo il cursore mucca */
    a, button, [role="button"], .thumb, nav a, .back { cursor: none !important; }

    /* === Livello effetti e particelle === */
    #fxLayer{position:fixed;inset:0;pointer-events:none;z-index:9998;overflow:visible}
    .cursor-cow{position:fixed;left:0;top:0;width:40px;height:40px;transform:translate(-50%,-50%);pointer-events:none;z-index:9999;filter:drop-shadow(0 4px 10px rgba(0,0,0,.15))}
    .cursor-cow svg{width:100%;height:100%}

    .cow-particle{position:fixed;width:28px;height:28px;left:0;top:0;transform:translate(0,0) scale(.95);
      animation:cowBurst var(--dur,2800ms) cubic-bezier(.22,.72,.12,1) forwards, cowSpin var(--dur,2800ms) linear forwards}
    @keyframes cowBurst{from{opacity:1;transform:translate(0,0) scale(1)}to{transform:translate(var(--dx),var(--dy)) scale(.95);opacity:0}}
    @keyframes cowSpin{from{rotate:0deg}to{rotate:var(--rot,360deg)}}

    /* Mucca testuale in basso a destra */
    #asciiCow{position:fixed;right:8px;bottom:8px;width:min(32vmin,420px);height:min(32vmin,420px);border:1px solid var(--border);background:#fff;z-index:60;pointer-events:none;box-shadow:0 6px 18px rgba(0,0,0,.08)}
    #asciiCow .frame{position:relative;width:100%;height:100%;overflow:hidden}
    #asciiCow pre{margin:0;position:absolute;bottom:8px;right:8px;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,'Liberation Mono',monospace;line-height:1;letter-spacing:.5px;white-space:pre;transform-origin:bottom right}
    @media (max-width:680px){#asciiCow{display:none}}

    /* su dispositivi touch torna il cursore di sistema */
    @media (pointer:coarse){ body{cursor:auto}.cursor-cow{display:none} }
  </style>
</head>
<body>
  <!-- layer effetti e cursore mucca -->
  <div id="fxLayer" aria-hidden="true"></div>
  <div id="cursorCow" class="cursor-cow" aria-hidden="true"></div>

  <!-- SVG mucca (fallback/particelle) -->
  <template id="cowSVG">
    <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <defs><clipPath id="cowClip"><circle cx="32" cy="34" r="20"/></clipPath></defs>
      <circle cx="32" cy="34" r="20" fill="#ffffff" stroke="#222" stroke-width="2.5"/>
      <ellipse cx="16" cy="26" rx="6" ry="8" fill="#fff" stroke="#222" stroke-width="2.5"/>
      <ellipse cx="48" cy="26" rx="6" ry="8" fill="#fff" stroke="#222" stroke-width="2.5"/>
      <ellipse cx="16" cy="26" rx="4" ry="5" fill="#ffc0d6" opacity=".8"/>
      <ellipse cx="48" cy="26" rx="4" ry="5" fill="#ffc0d6" opacity=".8"/>
      <g clip-path="url(#cowClip)">
        <ellipse cx="24" cy="34" rx="8" ry="6" fill="#1a1a1a" opacity=".9"/>
        <ellipse cx="42" cy="44" rx="6" ry="4" fill="#1a1a1a" opacity=".9"/>
      </g>
      <circle cx="26" cy="34" r="2.3" fill="#111"/>
      <circle cx="38" cy="34" r="2.3" fill="#111"/>
      <ellipse cx="32" cy="46" rx="11" ry="8" fill="#ffb3c7" stroke="#222" stroke-width="2"/>
      <circle cx="28" cy="46" r="1.6" fill="#7a2a2a"/>
      <circle cx="36" cy="46" r="1.6" fill="#7a2a2a"/>
    </svg>
  </template>

  <div class="wrap">
    <header>
      <h1 id="siteTitle">maria isolina cozzani</h1>
      <nav aria-label="primary">
        <a href="#works">works</a>
        <a href="#bio">bio</a>
        <a href="#contact">contact</a>
      </nav>
    </header>

    <main id="content" role="main" tabindex="-1">
      <section id="works" aria-label="works">
        <h2 class="sr-only">works</h2>
        <div class="gallery grid thumbs" id="thumbs"></div>
      </section>

      <section id="work-detail" class="work-detail" hidden></section>

      <section id="bio" hidden>
        <div class="bio-grid">
          <aside class="bio-aside">
            <h2>bio</h2>
            <p class="muted small">Extended CV and photos available on request.</p>
          </aside>
          <div class="bio-content">
            <p><strong>Maria Isolina Cozzani</strong> (b. 1994, Ludwigsburg) is an Italian-German violinist, composer-performer and multimedia artist based in Cologne. Working at the edges of free improvisation, electroacoustic performance and installation, she focuses on timbral extremes of the violin, spectral/granular resynthesis and spatial sound (4–8-channel and site-responsive setups). Her practice often integrates audio-reactive objects and upcycled technologies, assembling fragile yet vibrant ecosystems where sound, bodies and space co-shape one another.</p>
            <p>She trained in classical and jazz violin at the conservatories of La Spezia and Genoa and completed an MMus at ArtEZ University of the Arts (Arnhem, 2023) with research in free improvisation that culminated in <em>ISLN — Geography of sounds, shapeshifting multiplicities</em>. Recent and ongoing projects include the free-improv quintet <em>Inopia</em> (album <em>Exoplanet</em>, 2025); the electroacoustic duo <em>O.P.M.L. — Our Past Microtonal Love</em>; and the ensembles <em>Trio Lavish</em> (winners of the <em>Erasmus Jazz Prijs 2023</em>) and <em>Edera Trees</em>.</p>
            <p>Her music draws on microtonality, memory as layering/return, and a choreographic attention to gesture, instrument and space. She has appeared at Palazzo Ducale (Genoa), Museo Bagatti Valsecchi (Milan), MA/IN Matera Intermedia Festival (Matera), De Thomas (Amsterdam) and The Grey Space (The Hague).</p>
            <p>Alongside artistic work, Maria is active as an educator and as a project manager. In 2025 she coordinated the interdisciplinary project week <em>Connecting the Dots</em> at ArtEZ University of the Arts.</p>
          </div>
        </div>
      </section>

      <section id="contact" hidden>
        <h2>contact</h2>
        <p class="contact-line">
          <svg class="icon-mail" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path d="M3 6.75A1.75 1.75 0 0 1 4.75 5h14.5A1.75 1.75 0 0 1 21 6.75v10.5A1.75 1.75 0 0 1 19.25 19H4.75A1.75 1.75 0 0 1 3 17.25V6.75Zm1.9.2 7.08 5.31c.13.1.31.1.44 0l7.08-5.31a.25.25 0 0 0-.15-.45H5.05a.25.25 0 0 0-.15.45Zm14.15 1.69-6.43 4.82a2.25 2.25 0 0 1-2.84 0L3.35 8.64v8.61c0 .14.11.25.25.25h16.8c.14 0 .25-.11.25-.25V8.64Z"></path>
          </svg>
          <span id="mail"></span>
        </p>
      </section>

      <!-- Works data (hidden) -->
      <section id="works-data" hidden>
        <!-- (…mantieni qui i tuoi <article> come nel file precedente …) -->
      </section>
    </main>

    <footer>
      <p>© <span id="y"></span> Maria Isolina Cozzani</p>
    </footer>
  </div>

  <!-- Mucca di testo (riempie il riquadro) -->
  <div id="asciiCow" aria-hidden="true"><div class="frame"><pre>
         (\\\\)
          ( \\ )
           (_  )      (__)                 __
           /  \\     (oo)              .-"  `-.
   /------/----\\-----\\/-------------.-'        `-.
  / |    |     ||    ||            /    .-""-.    \\
 *  /\\___/\\____/\\____/\\           ;    /  ..  \\    ;
    ~~    ~~   ~~   ~~            |   |  (__)  |   |
                                  |   |  /__\\  |   |
                                  ;    \\      /    ;
                                   \\    `----'    /
                                    `-.________.-'
  </pre></div></div>

  <!-- JSON-LD (rimane uguale al tuo) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Person",
    "name":"Maria Isolina Cozzani",
    "jobTitle":"Violinist, Composer-Performer, Multimedia Artist",
    "url":"https://tuodominio.example/",
    "worksFeatured":[
      {"@type":"CreativeWork","name":"Violin and Algorithm Duet","url":"https://tuodominio.example/#work/violin-algorithm-duet"},
      {"@type":"CreativeWork","name":"what is left, what there grows","url":"https://tuodominio.example/#work/what-is-left"}
    ]
  }
  </script>

  <script>
  'use strict';

  // Footer year
  document.getElementById('y').textContent = new Date().getFullYear();

  const worksSection = document.querySelector('#works-data');
  const thumbsWrap   = document.getElementById('thumbs');
  const siteTitle    = document.getElementById('siteTitle');

  const POSTER_OVERRIDES = {
    'violin-algorithm-duet': 'https://img.youtube.com/vi/dUpo4ffqWa8/hqdefault.jpg',
    'artemide': 'assets/artemide/artemide_6.jpg',
    'exoplanet': 'assets/exoplanet/SM4830.jpg',
    'lavish-trio': 'assets/dump_and_die/lavish-cover-1200.jpg',
    'isln': 'assets/ISLN/isln-cover-1200.jpg',
    'edera': 'assets/edera/edera1.jpeg',
    '1142km': 'assets/1142_km/1492.png',
    'solo-livingroom': 'assets/livingroom/livingroom.jpg'
  };

  function getYouTubeThumb(id){ return `https://img.youtube.com/vi/${id}/hqdefault.jpg`; }

  // Build gallery from hidden articles
  function buildThumb(article){
    const id = article.id;
    const title = article.dataset.title || id;
    let thumbURL = '';

    if (article.dataset.poster) {
      try { thumbURL = new URL(article.dataset.poster, document.baseURI).href; }
      catch(e){ thumbURL = article.dataset.poster; }
    }
    if (!thumbURL && POSTER_OVERRIDES[id]) thumbURL = POSTER_OVERRIDES[id];
    if (!thumbURL && (article.dataset.yt || article.dataset.ytList)) {
      const firstId = (article.dataset.yt || article.dataset.ytList.split(',')[0].trim());
      thumbURL = getYouTubeThumb(firstId);
    }

    const a = document.createElement('a');
    a.href = `#work/${id}`;
    a.className = 'thumb';
    a.setAttribute('aria-label', title);

    if (thumbURL){
      const img = document.createElement('img');
      img.className = 'poster'; img.loading='lazy'; img.decoding='async'; img.alt=title; img.src=thumbURL;
      a.appendChild(img);
    } else {
      const ph = document.createElement('div');
      ph.className = 'poster';
      ph.style.background = 'linear-gradient(135deg, rgba(0,0,0,0.06), rgba(0,0,0,0.02))';
      a.appendChild(ph);
    }
    return a;
  }

  function buildGallery(){
    thumbsWrap.innerHTML = '';
    if (!worksSection) return;

    const desiredOrder = [
      'violin-algorithm-duet', 'what-is-left', 'exoplanet', 'lavish-trio',
      'isln', 'artemide', 'solo-livingroom', 'edera', '1142km', 'locked-outputs',
      'studio-sul-plasma', 'steps-to-be-taken'
    ];
    const orderMap = new Map(desiredOrder.map((id,i)=>[id,i]));
    const articles = Array.from(worksSection.querySelectorAll('article'))
      .sort((a,b)=>(orderMap.get(a.id) ?? 999) - (orderMap.get(b.id) ?? 999));

    articles.forEach((a,idx)=>{
      const el = buildThumb(a);
      const img = el.querySelector('img');
      if (idx<2 && img) img.setAttribute('fetchpriority','high');
      thumbsWrap.appendChild(el);
    });
  }

  function createEmbedIframe(kind,id,title){
    const div = document.createElement('div'); div.className='embed';
    let url='';
    if (kind==='yt'){ url=`https://www.youtube-nocookie.com/embed/${id}`;
      div.innerHTML=`<iframe loading="lazy" src="${url}" title="${title}" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
    } else if (kind==='vimeo'){ url=`https://player.vimeo.com/video/${id}?dnt=1&byline=0&portrait=0`;
      div.innerHTML=`<iframe loading="lazy" src="${url}" title="${title}" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>`;
    } else if (kind==='drive'){ url=`https://drive.google.com/file/d/${id}/preview`;
      div.innerHTML=`<iframe loading="lazy" src="${url}" title="${title}"></iframe>`;
    }
    return div;
  }

  function createMediaBlock(article){
    const ds = article.dataset;
    const title = ds.title || article.id;
    const entries = [];
    if (ds.ytList){ ds.ytList.split(',').map(s=>s.trim()).filter(Boolean).forEach(id=>entries.push(['yt',id])); }
    if (ds.vimeoList){ ds.vimeoList.split(',').map(s=>s.trim()).filter(Boolean).forEach(id=>entries.push(['vimeo',id])); }
    if (ds.driveList){ ds.driveList.split(',').map(s=>s.trim()).filter(Boolean).forEach(id=>entries.push(['drive',id])); }
    if (ds.yt) entries.push(['yt',ds.yt]);
    if (ds.vimeo) entries.push(['vimeo',ds.vimeo]);
    if (ds.drive) entries.push(['drive',ds.drive]);

    if (!entries.length) return null;

    if (entries.length===1 && ds.poster && !article.querySelector('img')){
      const wrap = document.createElement('div'); wrap.className='detail-media-grid';
      wrap.appendChild(createEmbedIframe(entries[0][0], entries[0][1], title));
      const img = document.createElement('img'); img.src = ds.poster; img.alt=title; img.loading='lazy'; img.decoding='async';
      wrap.appendChild(img);
      return wrap;
    }
    const container = document.createElement('div');
    if (entries.length>1) container.className='video-grid';
    entries.forEach(([kind,id])=>container.appendChild(createEmbedIframe(kind,id,title)));
    return container;
  }

  function setActiveNav(section){
    document.querySelectorAll('nav a[href^="#"]').forEach(a=>{
      a.removeAttribute('aria-current');
      if (a.getAttribute('href')===`#${section}`) a.setAttribute('aria-current','page');
    });
  }

  function showTop(section){
    ['works','bio','contact'].forEach(id=>{
      const el = document.getElementById(id);
      if (el) el.hidden = (id!==section);
    });
    document.body.classList.remove('is-detail');
    const detailEl = document.getElementById('work-detail');
    if (detailEl){ detailEl.setAttribute('hidden',''); detailEl.innerHTML=''; }
    if (section==='works'){ window.scrollTo(0,0); }
    setActiveNav(section);
  }

  function showWork(slug){
    const article = document.getElementById(slug);
    if (!article){ showTop('works'); return; }

    document.body.classList.add('is-detail');
    const detailEl = document.getElementById('work-detail');
    detailEl.removeAttribute('hidden');
    detailEl.innerHTML = `<a href="#works" class="back">← all works</a>`;

    const media = createMediaBlock(article);
    if (media) detailEl.appendChild(media);

    const clone = article.cloneNode(true); clone.removeAttribute('id'); detailEl.appendChild(clone);
    window.scrollTo(0,0);
  }

  function handleRoute(){
    const h = decodeURIComponent(location.hash || '#works');
    if (h.indexOf('#work/')===0){ showWork(h.slice(6)); return; }
    const sec = h.replace('#','');
    if (['bio','contact','works'].includes(sec)) showTop(sec);
    else showTop('works');
  }

  function initNavInstant(){
    document.querySelectorAll('nav a[href^="#"]').forEach(a=>{
      a.addEventListener('click', e=>{
        const target = a.getAttribute('href').slice(1);
        if (['bio','contact','works'].includes(target)){
          e.preventDefault();
          history.replaceState(null,'',`#${target}`);
          showTop(target);
        }
      });
    });
  }

  function hardenExternalLinks(){
    document.querySelectorAll('a[target="_blank"]').forEach(a=>{
      const rel = (a.getAttribute('rel')||'').split(' ').filter(Boolean);
      if (!rel.includes('noopener')) rel.push('noopener');
      if (!rel.includes('noreferrer')) rel.push('noreferrer');
      a.setAttribute('rel', rel.join(' '));
    });
  }

  function injectMail(){
    const m='mariacozzani'+'@'+'gmail.com';
    const el=document.getElementById('mail');
    if (el) el.innerHTML = `<a href="mailto:${m}">${m}</a>`;
  }

  // === Cursore mucca (foto) + fuochi d’artificio sul titolo ===
  (function initCows(){
    const fxLayer   = document.getElementById('fxLayer');
    const cursorCow = document.getElementById('cursorCow');
    const tpl       = document.getElementById('cowSVG');

    function setCursorPhoto(){
      const img = new Image();
      img.src = 'assets/cow-cursor.jpg'; // ⬅️ metti qui la tua foto della mucca in Svizzera
      img.alt = ''; img.decoding='async'; img.loading='eager';
      img.onerror = ()=>{ if(!cursorCow.firstChild) cursorCow.appendChild(tpl.content.cloneNode(true)); };
      cursorCow.replaceChildren(img);
    }
    setCursorPhoto();

    window.addEventListener('pointermove', e=>{
      cursorCow.style.left = e.clientX+'px';
      cursorCow.style.top  = e.clientY+'px';
    });

    function spawn(x,y,opts){
      const el = document.createElement('div'); el.className='cow-particle';
      el.style.left=x+'px'; el.style.top=y+'px';
      const speed = (opts&&opts.speed!=null)?opts.speed:(140+Math.random()*220);
      const ang   = (opts&&opts.angle!=null)?opts.angle:(Math.random()*Math.PI*2);
      const dx    = Math.cos(ang)*speed, dy=Math.sin(ang)*speed;
      const rot   = ((opts&&opts.rot!=null)?opts.rot:(240+Math.random()*600))+'deg';
      const dur   = ((opts&&opts.dur!=null)?opts.dur:(2600+Math.random()*1200))+'ms';
      el.style.setProperty('--dx', dx+'px'); el.style.setProperty('--dy', dy+'px');
      el.style.setProperty('--rot', rot);    el.style.setProperty('--dur', dur);
      el.appendChild(tpl.content.cloneNode(true));
      fxLayer.appendChild(el);
      el.addEventListener('animationend', ()=>el.remove());
    }
    function burst(x,y,count){ for(let i=0;i<count;i++) spawn(x,y,{speed:160+Math.random()*200,rot:240+Math.random()*720,dur:2600+Math.random()*1200}); }

    let lastBurst = 0;
    function titleBurst(intense){
      const now = performance.now();
      if (!intense && now-lastBurst<1200) return;
      lastBurst = now;
      const r = siteTitle.getBoundingClientRect();
      const cx = r.left + r.width/2;
      const cy = r.top  + r.height/2;
      const bursts = intense?3:2;
      for (let b=0;b<bursts;b++){
        const ox = cx + (Math.random()*2-1)*r.width*0.25;
        const oy = cy + (Math.random()*2-1)*r.height*0.6;
        burst(ox, oy, intense?28:18);
      }
    }
    siteTitle.addEventListener('mouseenter', ()=>titleBurst(false));
    siteTitle.addEventListener('click',      ()=>titleBurst(true));
  })();

  // === Fish-eye continuo + influenza del mouse ===
  function enableFisheye(){
    if (!thumbsWrap) return;

    const items = [];
    function measure(){
      items.length = 0;
      thumbsWrap.querySelectorAll('.thumb').forEach(el=>{
        const r = el.getBoundingClientRect();
        items.push({el, cx:r.left + r.width/2, cy:r.top + r.height/2});
      });
    }

    let hasMouse=false, mx=0, my=0;
    const MAX_SCALE = 1.18, MIN_SCALE = 0.86;
    const SIGMA_MOUSE = 160, SIGMA_DRIFT = 220;

    const gauss = (x1,y1,x2,y2,s)=>{ const d=Math.hypot(x1-x2,y1-y2); return Math.exp(-(d*d)/(2*s*s)); };

    function tick(t){
      const r = thumbsWrap.getBoundingClientRect();
      const time = t*0.001;

      // punto “vagante” che attraversa la griglia
      const dx = r.left + r.width  * (0.5 + 0.35*Math.sin(time*0.33));
      const dy = r.top  + r.height * (0.5 + 0.35*Math.sin(time*0.47 + 1.2));

      for (let i=0;i<items.length;i++){
        const it = items[i];
        const wMouse = hasMouse ? gauss(it.cx,it.cy,mx,my,SIGMA_MOUSE) : 0;
        const wDrift = gauss(it.cx,it.cy,dx,dy,SIGMA_DRIFT);
        const wPhase = (Math.sin(time*0.9 + i*0.8)+1)*0.22; // 0..0.44
        const influence = Math.min(1, wMouse*0.9 + wDrift*0.7 + wPhase*0.6);
        const s = MIN_SCALE + (MAX_SCALE - MIN_SCALE) * influence;
        it.el.style.setProperty('--s', s.toFixed(3));
        it.el.style.zIndex = (100 + Math.round(s*100)) + '';
      }
      requestAnimationFrame(tick);
    }

    thumbsWrap.addEventListener('mousemove', e=>{hasMouse=true; mx=e.clientX; my=e.clientY;},{passive:true});
    thumbsWrap.addEventListener('mouseleave', ()=>{hasMouse=false;},{passive:true});
    window.addEventListener('resize', measure,{passive:true});

    measure();
    setTimeout(measure, 250);
    requestAnimationFrame(tick);
  }

  // Fit della mucca ASCII nel riquadro
  function fitAsciiCow(){
    const box = document.getElementById('asciiCow'); if (!box) return;
    const pre = box.querySelector('pre'); if (!pre) return;
    pre.style.transform = 'scale(1)';
    requestAnimationFrame(()=>{
      const bw = box.clientWidth-16, bh = box.clientHeight-16;
      const sw = pre.scrollWidth,  sh = pre.scrollHeight;
      const s = Math.min(bw/sw, bh/sh) * 1.02;
      pre.style.transform = 'scale('+s+')';
    });
  }

  // Routing & init
  window.addEventListener('hashchange', handleRoute);
  document.addEventListener('DOMContentLoaded', ()=>{
    buildGallery();
    handleRoute();
    initNavInstant();
    hardenExternalLinks();
    injectMail();
    enableFisheye();
    fitAsciiCow();
  });
  window.addEventListener('resize', fitAsciiCow);
  </script>
</body>
</html>
